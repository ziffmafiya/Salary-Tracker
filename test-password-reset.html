<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест сброса пароля - Salary Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Tektur:wght@400..900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="reset-password-container">
            <div class="reset-password-form">
                <h2>Тест сброса пароля</h2>
                
                <div class="test-section">
                    <h3>1. Тест через Telegram бот</h3>
                    <p>Отправьте боту команду:</p>
                    <code>/reset_password your_email@example.com</code>
                    <p>Замените <code>your_email@example.com</code> на ваш реальный email.</p>
                </div>

                <div class="test-section">
                    <h3>2. Тест веб-интерфейса</h3>
                    <p>Для тестирования веб-интерфейса используйте URL:</p>
                    <code>reset-password.html?token=TEST_TOKEN&email=your_email@example.com</code>
                </div>

                <div class="test-section">
                    <h3>3. Проверка настроек</h3>
                    <ul>
                        <li>✅ Таблица <code>password_reset_tokens</code> создана в Supabase</li>
                        <li>✅ RLS политики настроены</li>
                        <li>✅ Telegram webhook обновлен</li>
                        <li>✅ Страница сброса пароля создана</li>
                        <li>✅ Переменные окружения настроены</li>
                    </ul>
                </div>

                <div class="test-section">
                    <h3>4. Логи для отладки</h3>
                    <div id="logs" style="background: #1a1a1a; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
                        <p>Логи будут отображаться здесь...</p>
                    </div>
                </div>

                <div class="form-footer">
                    <a href="index.html">Вернуться к главной странице</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Функция для добавления логов
        function addLog(message) {
            const logsDiv = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('p');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        // Проверяем наличие необходимых файлов
        document.addEventListener('DOMContentLoaded', () => {
            addLog('Загрузка тестовой страницы...');
            
            // Проверяем наличие файлов
            const requiredFiles = [
                'api/telegram-webhook.js',
                'reset-password.html',
                'reset-password.js',
                'database_setup.sql'
            ];

            requiredFiles.forEach(file => {
                fetch(file, { method: 'HEAD' })
                    .then(response => {
                        if (response.ok) {
                            addLog(`✅ ${file} - найден`);
                        } else {
                            addLog(`❌ ${file} - не найден`);
                        }
                    })
                    .catch(() => {
                        addLog(`❌ ${file} - ошибка при проверке`);
                    });
            });

            // Проверяем переменные окружения (если доступны)
            if (typeof SUPABASE_URL !== 'undefined' && typeof SUPABASE_ANON_KEY !== 'undefined') {
                addLog('✅ Переменные Supabase настроены');
            } else {
                addLog('❌ Переменные Supabase не найдены');
            }

            addLog('Тест завершен. Проверьте логи выше.');
        });
    </script>
</body>
</html> 